"use strict";(self.webpackChunkngx_admin_demo=self.webpackChunkngx_admin_demo||[]).push([[845],{6845:(Z,f,s)=>{s.r(f),s.d(f,{AuthModule:()=>P});var o=s(8833),C=s(6366),l=s(4006),u=s(7672),e=s(2963);let b=(()=>{class n{constructor(t,r,a){this.toast=t,this.router=r,this.route=a}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(o.quB),e.Y36(u.F0),e.Y36(u.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ngx-auth"]],decls:9,vars:0,consts:[[2,"height","100%"],[1,"navigation"],["href","pages","aria-label","Back",1,"link","back-link"],["icon","arrow-back"]],template:function(t,r){1&t&&(e.TgZ(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card",0)(3,"nb-card-header")(4,"nav",1)(5,"a",2),e._UZ(6,"nb-icon",3),e.qZA()()(),e.TgZ(7,"nb-card-body"),e._UZ(8,"router-outlet"),e.qZA()()()())},dependencies:[u.lC,o.Aqw,o.dP_,o.Asz,o.yKW,o.ndF,o.fMN],styles:["[_nghost-%COMP%]{margin:auto}[_nghost-%COMP%]   nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}"]}),n})();var y=s(9671),g=s(2340),d=s(743),h=s(4276),m=s(529);let M=(()=>{class n extends h.UP{constructor(t){super({apiUrl:g.N.url_api,entity:"auth/login"},t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(m.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),A=(()=>{class n extends h.UP{constructor(t){super({apiUrl:g.N.url_api,entity:"sys/user"},t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(m.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),k=(()=>{class n extends h.UP{constructor(t){super({apiUrl:g.N.url_api,entity:"auth/capabilities"},t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(m.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),x=(()=>{class n extends h.UP{constructor(t){super({apiUrl:g.N.url_api,entity:"auth/refreshtoken"},t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(m.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var v=s(6895);function L(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nb-card",2),e.NdJ("keyup.enter",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.login())})("keydown.enter",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.login())}),e.TgZ(1,"nb-card-header"),e._uU(2,"\u0110\u0103ng nh\u1eadp"),e.qZA(),e.TgZ(3,"nb-card-body")(4,"input",3),e.NdJ("ngModelChange",function(a){e.CHM(t);const c=e.oxw();return e.KtG(c.username=a)}),e.qZA(),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(a){e.CHM(t);const c=e.oxw();return e.KtG(c.password=a)}),e.qZA()(),e.TgZ(6,"nb-card-footer")(7,"button",5),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.login())}),e._uU(8," \u0110\u0103ng nh\u1eadp "),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngModel",t.username),e.xp6(1),e.Q6J("ngModel",t.password),e.xp6(2),e.Q6J("nbSpinner",t.isLoging)}}function S(n,i){1&n&&(e.TgZ(0,"section",6)(1,"span",7),e._uU(2,"\u0110ang \u0111\u0103ng nh\u1eadp..."),e.qZA(),e._UZ(3,"span",8),e.qZA())}const T=[{path:"",component:b,children:[{path:"login",component:(()=>{class n{constructor(t,r,a,c,p,N,O){this.loginService=t,this.userService=r,this.capabilitiesService=a,this.refreshTokenService=c,this.toast=p,this.router=N,this.route=O,this.isLoging=!1,this.isLoading=!0}ngOnInit(){this.checkToken()}checkToken(){var t=this;return(0,y.Z)(function*(){try{(yield t.refreshTokenService.getOne("").toPromise())&&t.router.navigateByUrl("pages")}catch{t.isLoading=!1}})()}login(){var t=this;return(0,y.Z)(function*(){t.isLoging=!0,localStorage.setItem(d.$.user_login,t.username);try{if(t.isValid()){const r=yield t.loginService.create({username:t.username,password:t.password}).toPromise();if(!r||!r.userId)throw new Error("Sai t\xe0i kho\u1ea3n ho\u1eb7c m\u1eadt kh\u1ea9u");{localStorage.setItem(d.$.accessToken,r.accessToken),t.userService.getOne(r.userId).toPromise();const a=yield t.capabilitiesService.getOne("").toPromise();if(a&&a.length>0){let c=!1;for(let p=0;p<a.length;p++)a[p]==g.N.app_id&&(c=!0);c?(localStorage.setItem(d.$.accessToken,r.accessToken),localStorage.setItem(d.$.userId,r.userId),localStorage.setItem(d.$.displayName,r.displayName),localStorage.setItem(d.$.roleId,r.roleId),t.router.navigateByUrl("pages/icon")):t.toast.danger("Kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp \u1ee9ng d\u1ee5ng")}else t.toast.danger("Kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp \u1ee9ng d\u1ee5ng")}}}catch(r){t.toast.danger(r.error?.message?r.error.message:r),t.isLoading=!1}finally{t.isLoging=!1,t.isLoading=!1}})()}isValid(){return!(!this.username||!this.password)||(this.toast.danger("Vui l\xf2ng nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin"),!1)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M),e.Y36(A),e.Y36(k),e.Y36(x),e.Y36(o.quB),e.Y36(u.F0),e.Y36(u.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ngx-login"]],decls:2,vars:2,consts:[[3,"keyup.enter","keydown.enter",4,"ngIf"],["class","loading",4,"ngIf"],[3,"keyup.enter","keydown.enter"],["nbInput","","type","username","placeholder","T\xean \u0111\u0103ng nh\u1eadp","required","","fullWidth","","title","Nh\u1eadp t\xean \u0111\u0103ng nh\u1eadp",3,"ngModel","ngModelChange"],["nbInput","","type","password","placeholder","M\u1eadt kh\u1ea9u","required","","fullWidth","","title","Nh\u1eadp m\u1eadt kh\u1ea9u",3,"ngModel","ngModelChange"],["nbButton","","submit","","fullWidth","","status","primary",3,"nbSpinner","click"],[1,"loading"],[1,"loadWords"],[1,"loading__anim"]],template:function(t,r){1&t&&(e.YNc(0,L,9,3,"nb-card",0),e.YNc(1,S,4,0,"section",1)),2&t&&(e.Q6J("ngIf",!r.isLoading),e.xp6(1),e.Q6J("ngIf",r.isLoading))},dependencies:[o.Asz,o.yKW,o.XWE,o.ndF,o.h8i,o.DPz,v.O5,l.Fj,l.JJ,l.Q7,l.On,o.Q7R],styles:["[_nghost-%COMP%]{margin:auto}[_nghost-%COMP%]   nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}nb-card[_ngcontent-%COMP%]{max-width:40%;margin:10% auto auto}body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.loading[_ngcontent-%COMP%]{max-width:50%;line-height:1.4;font-size:1.2rem;font-weight:700;text-align:center;margin:auto}.loadWords[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem;color:#bdbdbd;margin:.6rem 0 2rem;display:block}.loading__anim[_ngcontent-%COMP%]{width:35px;height:35px;border:5px solid rgba(189,189,189,.25);border-left-color:#039be5;border-top-color:#039be5;border-radius:50%;display:inline-block;animation:rotate .6s infinite linear}@keyframes rotate{to{transform:rotate(1turn)}}"]}),n})()},{path:"",redirectTo:"login",pathMatch:"full"}]}];let I=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.Bz.forChild(T),u.Bz]}),n})();var _=s(8405);let w=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[o.j5J,o.zyh,o.nKr,_.$,o.KdK,o.T2N,o.EoG,o.CG_,v.ez,l.u5,o.uuI]}),n})(),P=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[I,C.O,l.u5,o.j5J,o.j7H,w,o.BW0,o.zyh,_.$,o.KdK]}),n})()}}]);