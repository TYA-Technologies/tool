"use strict";(self.webpackChunkngx_admin_demo=self.webpackChunkngx_admin_demo||[]).push([[337],{4337:(P,m,s)=>{s.r(m),s.d(m,{AuthModule:()=>k});var o=s(8833),b=s(6366),u=s(4006),l=s(7672),n=s(2963);let C=(()=>{class e{constructor(t,r,a){this.toast=t,this.router=r,this.route=a}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(o.quB),n.Y36(l.F0),n.Y36(l.gz))},e.\u0275cmp=n.Xpm({type:e,selectors:[["ngx-auth"]],decls:9,vars:0,consts:[[2,"height","100%"],[1,"navigation"],["href","pages","aria-label","Back",1,"link","back-link"],["icon","arrow-back"]],template:function(t,r){1&t&&(n.TgZ(0,"nb-layout")(1,"nb-layout-column")(2,"nb-card",0)(3,"nb-card-header")(4,"nav",1)(5,"a",2),n._UZ(6,"nb-icon",3),n.qZA()()(),n.TgZ(7,"nb-card-body"),n._UZ(8,"router-outlet"),n.qZA()()()())},dependencies:[l.lC,o.Aqw,o.dP_,o.Asz,o.yKW,o.ndF,o.fMN],styles:["[_nghost-%COMP%]{margin:auto}[_nghost-%COMP%]   nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}"]}),e})();var f=s(9671),d=s(2340),p=s(4276),h=s(529);let v=(()=>{class e extends p.UP{constructor(t){super({apiUrl:d.N.url_api,entity:"auth/login"},t)}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(h.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),M=(()=>{class e extends p.UP{constructor(t){super({apiUrl:d.N.url_api,entity:"sys/user"},t)}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(h.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),A=(()=>{class e extends p.UP{constructor(t){super({apiUrl:d.N.url_api,entity:"auth/capabilities"},t)}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(h.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var y=s(6895);function L(e,i){if(1&e){const t=n.EpF();n.TgZ(0,"nb-card",2),n.NdJ("keyup.enter",function(){n.CHM(t);const a=n.oxw();return n.KtG(a.login())})("keydown.enter",function(){n.CHM(t);const a=n.oxw();return n.KtG(a.login())}),n.TgZ(1,"nb-card-header"),n._uU(2,"\u0110\u0103ng nh\u1eadp"),n.qZA(),n.TgZ(3,"nb-card-body")(4,"input",3),n.NdJ("ngModelChange",function(a){n.CHM(t);const c=n.oxw();return n.KtG(c.username=a)}),n.qZA(),n.TgZ(5,"input",4),n.NdJ("ngModelChange",function(a){n.CHM(t);const c=n.oxw();return n.KtG(c.password=a)}),n.qZA()(),n.TgZ(6,"nb-card-footer")(7,"button",5),n.NdJ("click",function(){n.CHM(t);const a=n.oxw();return n.KtG(a.login())}),n._uU(8," \u0110\u0103ng nh\u1eadp "),n.qZA()()()}if(2&e){const t=n.oxw();n.xp6(4),n.Q6J("ngModel",t.username),n.xp6(1),n.Q6J("ngModel",t.password),n.xp6(2),n.Q6J("nbSpinner",t.isLoging)}}function x(e,i){1&e&&(n.TgZ(0,"section",6)(1,"span",7),n._uU(2,"\u0110ang \u0111\u0103ng nh\u1eadp..."),n.qZA(),n._UZ(3,"span",8),n.qZA())}const S=[{path:"",component:C,children:[{path:"login",component:(()=>{class e{constructor(t,r,a,c,g,w){this.loginService=t,this.userService=r,this.capabilitiesService=a,this.toast=c,this.router=g,this.route=w,this.isLoging=!1,this.isLoading=!0}ngOnInit(){this.autoLogin()}autoLogin(){this.username=localStorage.getItem("user_login"),this.password=localStorage.getItem("pass_login"),this.login()}checkToken(){return(0,f.Z)(function*(){})()}login(){var t=this;return(0,f.Z)(function*(){t.isLoging=!0,localStorage.setItem("user_login",t.username),localStorage.setItem("pass_login",t.password);try{if(t.isValid()){const r=yield t.loginService.create({username:t.username,password:t.password}).toPromise();if(!r||!r.userId)throw new Error("Sai t\xe0i kho\u1ea3n ho\u1eb7c m\u1eadt kh\u1ea9u");{localStorage.setItem("accessToken",r.accessToken),t.userService.getOne(r.userId).toPromise();const a=yield t.capabilitiesService.getOne("").toPromise();if(a&&a.length>0){let c=!1;for(let g=0;g<a.length;g++)a[g]==d.N.app_id&&(c=!0);c?(localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("userId",r.userId),localStorage.setItem("displayName",r.displayName),localStorage.setItem("roleId",r.roleId),t.router.navigateByUrl("pages/tao-lap-bo-tieu-chi")):t.toast.danger("Kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp \u1ee9ng d\u1ee5ng")}else t.toast.danger("Kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp \u1ee9ng d\u1ee5ng")}}}catch(r){t.toast.danger(r.error?.message?r.error.message:r),t.isLoading=!1}finally{t.isLoging=!1,t.isLoading=!1}})()}isValid(){return!(!this.username||!this.password)||(this.toast.danger("Vui l\xf2ng nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin"),!1)}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v),n.Y36(M),n.Y36(A),n.Y36(o.quB),n.Y36(l.F0),n.Y36(l.gz))},e.\u0275cmp=n.Xpm({type:e,selectors:[["ngx-login"]],decls:2,vars:2,consts:[[3,"keyup.enter","keydown.enter",4,"ngIf"],["class","loading",4,"ngIf"],[3,"keyup.enter","keydown.enter"],["nbInput","","type","username","placeholder","T\xean \u0111\u0103ng nh\u1eadp","required","","fullWidth","","title","Nh\u1eadp t\xean \u0111\u0103ng nh\u1eadp",3,"ngModel","ngModelChange"],["nbInput","","type","password","placeholder","M\u1eadt kh\u1ea9u","required","","fullWidth","","title","Nh\u1eadp m\u1eadt kh\u1ea9u",3,"ngModel","ngModelChange"],["nbButton","","submit","","fullWidth","","status","primary",3,"nbSpinner","click"],[1,"loading"],[1,"loadWords"],[1,"loading__anim"]],template:function(t,r){1&t&&(n.YNc(0,L,9,3,"nb-card",0),n.YNc(1,x,4,0,"section",1)),2&t&&(n.Q6J("ngIf",!r.isLoading),n.xp6(1),n.Q6J("ngIf",r.isLoading))},dependencies:[o.Asz,o.yKW,o.XWE,o.ndF,o.h8i,o.DPz,y.O5,u.Fj,u.JJ,u.Q7,u.On,o.Q7R],styles:["[_nghost-%COMP%]{margin:auto}[_nghost-%COMP%]   nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}nb-card[_ngcontent-%COMP%]{max-width:40%;margin:10% auto auto}body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh}.loading[_ngcontent-%COMP%]{max-width:50%;line-height:1.4;font-size:1.2rem;font-weight:700;text-align:center;margin:auto}.loadWords[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem;color:#bdbdbd;margin:.6rem 0 2rem;display:block}.loading__anim[_ngcontent-%COMP%]{width:35px;height:35px;border:5px solid rgba(189,189,189,.25);border-left-color:#039be5;border-top-color:#039be5;border-radius:50%;display:inline-block;animation:rotate .6s infinite linear}@keyframes rotate{to{transform:rotate(1turn)}}"]}),e})()},{path:"",redirectTo:"login",pathMatch:"full"}]}];let I=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[l.Bz.forChild(S),l.Bz]}),e})();var _=s(8405);let T=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[o.j5J,o.zyh,o.nKr,_.$,o.KdK,o.T2N,o.EoG,o.CG_,y.ez,u.u5,o.uuI]}),e})(),k=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[I,b.O,u.u5,o.j5J,o.j7H,T,o.BW0,o.zyh,_.$,o.KdK]}),e})()}}]);